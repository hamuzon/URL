<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>Short Link Generator (ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹)</title>
  <!-- ã‚¢ã‚¤ã‚³ãƒ³ã¯index.htmlã¨åŒã˜ãƒ•ã‚©ãƒ«ãƒ€ã«icon.svgã¨ã—ã¦é…ç½®ã—ã¦ãã ã•ã„ -->
  <link rel="icon" href="icon.svg" type="image/svg+xml" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@700&family=M+PLUS+Rounded+1c&display=swap" rel="stylesheet" />

  <style>
    /* CSSå¤‰æ•°ã§ãƒ©ã‚¤ãƒˆãƒ†ãƒ¼ãƒã¨ãƒ€ãƒ¼ã‚¯ãƒ†ãƒ¼ãƒã®è‰²ã‚’å®šç¾©ã—ã¾ã™ */
    :root {
      --color-bg-light: #fff0f6; /* ãƒ©ã‚¤ãƒˆãƒ†ãƒ¼ãƒã®èƒŒæ™¯è‰² */
      --color-bg-dark: #1b1b1b; /* ãƒ€ãƒ¼ã‚¯ãƒ†ãƒ¼ãƒã®èƒŒæ™¯è‰² */
      --color-text-light: #3b1f2b; /* ãƒ©ã‚¤ãƒˆãƒ†ãƒ¼ãƒã®ãƒ†ã‚­ã‚¹ãƒˆè‰² */
      --color-text-dark: #f0e9e0; /* ãƒ€ãƒ¼ã‚¯ãƒ†ãƒ¼ãƒã®ãƒ†ã‚­ã‚¹ãƒˆè‰² */
      --color-accent-light: #b34a2f; /* ãƒ©ã‚¤ãƒˆãƒ†ãƒ¼ãƒã®ã‚¢ã‚¯ã‚»ãƒ³ãƒˆè‰² */
      --color-accent-dark: #f2c9b3; /* ãƒ€ãƒ¼ã‚¯ãƒ†ãƒ¼ãƒã®ã‚¢ã‚¯ã‚»ãƒ³ãƒˆè‰² */
      --color-button-bg-light: #f6c6c1; /* ãƒ©ã‚¤ãƒˆãƒ†ãƒ¼ãƒã®ãƒœã‚¿ãƒ³èƒŒæ™¯è‰² */
      --color-button-bg-dark: #b75a42; /* ãƒ€ãƒ¼ã‚¯ãƒ†ãƒ¼ãƒã®ãƒœã‚¿ãƒ³èƒŒæ™¯è‰² */
      --color-button-hover-light: #f7a6a2; /* ãƒ©ã‚¤ãƒˆãƒ†ãƒ¼ãƒã®ãƒœã‚¿ãƒ³ãƒ›ãƒãƒ¼è‰² */
      --color-button-hover-dark: #d1734f; /* ãƒ€ãƒ¼ã‚¯ãƒ†ãƒ¼ãƒã®ãƒœã‚¿ãƒ³ãƒ›ãƒãƒ¼è‰² */
    }

    /* å…¨ä½“ã®ãƒœãƒ‡ã‚£ã‚¹ã‚¿ã‚¤ãƒ« */
    body {
      font-family: 'M PLUS Rounded 1c', 'Comic Neue', cursive, sans-serif; /* ãƒ•ã‚©ãƒ³ãƒˆãƒ•ã‚¡ãƒŸãƒªãƒ¼ */
      background-color: var(--color-bg-light); /* èƒŒæ™¯è‰²ï¼ˆãƒ©ã‚¤ãƒˆãƒ†ãƒ¼ãƒï¼‰ */
      color: var(--color-text-light); /* ãƒ†ã‚­ã‚¹ãƒˆè‰²ï¼ˆãƒ©ã‚¤ãƒˆãƒ†ãƒ¼ãƒï¼‰ */
      padding: 2rem; /* å†…å´ã®ä½™ç™½ */
      max-width: 600px; /* æœ€å¤§å¹… */
      margin: auto; /* ä¸­å¤®æƒãˆ */
      line-height: 1.6; /* è¡Œã®é«˜ã• */
      box-sizing: border-box; /* ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã¨ãƒœãƒ¼ãƒ€ãƒ¼ã‚’å¹…ã«å«ã‚ã‚‹ */
    }

    /* ãƒ˜ãƒƒãƒ€ãƒ¼ (h1) ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    h1 {
      text-align: center; /* ä¸­å¤®æƒãˆ */
      font-weight: 700; /* å¤ªå­— */
      font-size: 2.4rem; /* ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚º */
      color: var(--color-accent-light); /* è‰²ï¼ˆãƒ©ã‚¤ãƒˆãƒ†ãƒ¼ãƒï¼‰ */
      text-shadow: 1px 1px 0 #fff3f3; /* ãƒ†ã‚­ã‚¹ãƒˆã®å½± */
      margin-bottom: 2rem; /* ä¸‹ã®ä½™ç™½ */
    }

    /* ãƒ•ã‚©ãƒ¼ãƒ ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    form {
      display: flex; /* Flexboxã‚’ä½¿ç”¨ */
      flex-direction: column; /* è¦ç´ ã‚’ç¸¦ã«ä¸¦ã¹ã‚‹ */
      gap: 1rem; /* è¦ç´ é–“ã®éš™é–“ */
      margin-top: 2rem; /* ä¸Šã®ä½™ç™½ */
      background-color: rgba(255, 255, 255, 0.8); /* åŠé€æ˜ã®èƒŒæ™¯ */
      padding: 1.5rem; /* å†…å´ã®ä½™ç™½ */
      border-radius: 20px; /* è§’ä¸¸ */
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1); /* å½± */
    }

    /* å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    input[type="url"] {
      padding: 0.8rem; /* å†…å´ã®ä½™ç™½ */
      font-size: 1.1rem; /* ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚º */
      border: 2px solid var(--color-accent-light); /* ãƒœãƒ¼ãƒ€ãƒ¼ */
      border-radius: 16px; /* è§’ä¸¸ */
      width: 100%; /* å¹…ã„ã£ã±ã„ */
      box-sizing: border-box; /* ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã¨ãƒœãƒ¼ãƒ€ãƒ¼ã‚’å¹…ã«å«ã‚ã‚‹ */
      transition: all 0.3s ease; /* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
    }

    /* å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    input::placeholder {
      color: #a66a5a; /* è‰² */
      font-style: italic; /* æ–œä½“ */
    }

    /* å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã•ã‚ŒãŸæ™‚ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    input:focus {
      border-color: var(--color-button-bg-light); /* ãƒœãƒ¼ãƒ€ãƒ¼è‰² */
      background-color: #fff4f6; /* èƒŒæ™¯è‰² */
      outline: none; /* ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’éè¡¨ç¤º */
      box-shadow: 0 0 0 3px rgba(179, 74, 47, 0.2); /* å½± */
    }

    /* ãƒœã‚¿ãƒ³ã®å…±é€šã‚¹ã‚¿ã‚¤ãƒ« */
    button {
      padding: 0.85rem 1.5rem; /* å†…å´ã®ä½™ç™½ */
      font-size: 1.1rem; /* ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚º */
      background-color: var(--color-button-bg-light); /* èƒŒæ™¯è‰²ï¼ˆãƒ©ã‚¤ãƒˆãƒ†ãƒ¼ãƒï¼‰ */
      color: var(--color-accent-light); /* ãƒ†ã‚­ã‚¹ãƒˆè‰²ï¼ˆãƒ©ã‚¤ãƒˆãƒ†ãƒ¼ãƒï¼‰ */
      border: none; /* ãƒœãƒ¼ãƒ€ãƒ¼ãªã— */
      border-radius: 20px; /* è§’ä¸¸ */
      cursor: pointer; /* ã‚«ãƒ¼ã‚½ãƒ«ã‚’ãƒã‚¤ãƒ³ã‚¿ãƒ¼ã« */
      font-weight: 700; /* å¤ªå­— */
      box-shadow: 1px 4px 8px rgba(179, 74, 47, 0.5); /* å½± */
      transition: all 0.3s ease; /* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
      width: 100%; /* å¹…ã„ã£ã±ã„ */
    }

    /* ãƒœã‚¿ãƒ³ãŒãƒ›ãƒãƒ¼ã•ã‚ŒãŸæ™‚ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    button:hover {
      background-color: var(--color-button-hover-light); /* èƒŒæ™¯è‰² */
      color: white; /* ãƒ†ã‚­ã‚¹ãƒˆè‰² */
      transform: translateY(-2px); /* å°‘ã—ä¸Šã«ç§»å‹• */
      box-shadow: 1px 6px 12px rgba(179, 74, 47, 0.6); /* å½±ã‚’å¼·èª¿ */
    }

    /* ã‚»ã‚«ãƒ³ãƒ€ãƒªãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ãªã©ï¼‰ */
    .secondary-button {
      background-color: transparent; /* èƒŒæ™¯è‰²ã‚’é€æ˜ã« */
      color: var(--color-accent-light); /* ãƒ†ã‚­ã‚¹ãƒˆè‰² */
      border: 2px dashed var(--color-accent-light); /* ç ´ç·šãƒœãƒ¼ãƒ€ãƒ¼ */
      box-shadow: none; /* å½±ãªã— */
    }

    /* ã‚»ã‚«ãƒ³ãƒ€ãƒªãƒœã‚¿ãƒ³ãŒãƒ›ãƒãƒ¼ã•ã‚ŒãŸæ™‚ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    .secondary-button:hover {
      background-color: #ffe9ec; /* èƒŒæ™¯è‰² */
      color: var(--color-accent-light); /* ãƒ†ã‚­ã‚¹ãƒˆè‰² */
      transform: translateY(0); /* ç§»å‹•ãªã— */
      box-shadow: none; /* å½±ãªã— */
    }

    /* çŸ­ç¸®URLè¡¨ç¤ºæ®µè½ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    #shortUrlDisplay, #hashDetectedDisplay {
      margin-top: 1.8rem; /* ä¸Šã®ä½™ç™½ */
      font-size: 1.15rem; /* ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚º */
      background-color: #ffe4e6; /* èƒŒæ™¯è‰² */
      padding: 1.1rem; /* å†…å´ã®ä½™ç™½ */
      border-left: 10px solid var(--color-accent-light); /* å·¦ãƒœãƒ¼ãƒ€ãƒ¼ */
      border-radius: 10px; /* è§’ä¸¸ */
      word-break: break-word; /* é•·ã„å˜èªã‚’æ”¹è¡Œ */
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05); /* å½± */
      display: none; /* åˆæœŸçŠ¶æ…‹ã§ã¯éè¡¨ç¤º */
    }

    /* ã‚³ãƒ”ãƒ¼ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    #copyButton, #openOriginalUrlButton {
      margin-top: 0.7rem; /* ä¸Šã®ä½™ç™½ */
      padding: 0.5rem 1rem; /* å†…å´ã®ä½™ç™½ */
      font-size: 0.95rem; /* ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚º */
      border-radius: 12px; /* è§’ä¸¸ */
      width: auto; /* å¹…ã‚’è‡ªå‹•èª¿æ•´ */
      display: inline-block; /* ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ãƒ–ãƒ­ãƒƒã‚¯è¦ç´  */
      box-shadow: 0 2px 4px rgba(179, 74, 47, 0.3); /* å½± */
    }

    /* ã‚³ãƒ”ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    #copyMessage {
      margin-left: 1em; /* å·¦ã®ä½™ç™½ */
      color: green; /* è‰² */
      font-weight: bold; /* å¤ªå­— */
      font-size: 0.9em; /* ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚º */
    }

    /* ãƒªãƒ³ã‚¯ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    a {
      color: var(--color-accent-light); /* è‰²ï¼ˆãƒ©ã‚¤ãƒˆãƒ†ãƒ¼ãƒï¼‰ */
      text-decoration: none; /* ä¸‹ç·šãªã— */
      font-weight: bold; /* å¤ªå­— */
    }

    /* ãƒªãƒ³ã‚¯ãŒãƒ›ãƒãƒ¼ã•ã‚ŒãŸæ™‚ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    a:hover {
      text-decoration: underline; /* ä¸‹ç·šã‚’è¡¨ç¤º */
    }

    /* ãƒ•ãƒƒã‚¿ãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    footer {
      text-align: center; /* ä¸­å¤®æƒãˆ */
      margin-top: 3rem; /* ä¸Šã®ä½™ç™½ */
      color: var(--color-accent-light); /* è‰²ï¼ˆãƒ©ã‚¤ãƒˆãƒ†ãƒ¼ãƒï¼‰ */
      font-size: 0.9rem; /* ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚º */
    }

    /* ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«é–¢ã™ã‚‹æ³¨æ„æ›¸ãã®ã‚¹ã‚¿ã‚¤ãƒ« */
    .local-storage-notice {
      font-size: 0.85em;
      color: #d9534f; /* èµ¤ç³»ã®è­¦å‘Šè‰² */
      margin-top: 1em;
      padding: 0.5em;
      border: 1px solid #d9534f;
      border-radius: 5px;
      background-color: rgba(217, 83, 79, 0.1); /* è–„ã„èƒŒæ™¯è‰² */
      /* display: none; ã‚’å‰Šé™¤ã—ã€å¸¸ã«è¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«å¤‰æ›´ */
    }

    /* ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã§ã®ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«é–¢ã™ã‚‹æ³¨æ„æ›¸ãã®ã‚¹ã‚¿ã‚¤ãƒ« */
    @media (prefers-color-scheme: dark) {
      .local-storage-notice {
        color: #f0ad4e; /* ã‚ªãƒ¬ãƒ³ã‚¸ç³»ã®è­¦å‘Šè‰² */
        border-color: #f0ad4e;
        background-color: rgba(240, 173, 78, 0.1);
      }
    }

    /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ã®èª¿æ•´ */
    @media (max-width: 768px) {
      body {
        padding: 1rem; /* å°ã•ã„ç”»é¢ã§ã¯ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’æ¸›ã‚‰ã™ */
      }
      h1 {
        font-size: 2rem; /* ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºã‚’èª¿æ•´ */
      }
      form {
        padding: 1rem; /* ãƒ•ã‚©ãƒ¼ãƒ ã®ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’èª¿æ•´ */
      }
      button {
        padding: 0.75rem 1rem; /* ãƒœã‚¿ãƒ³ã®ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’èª¿æ•´ */
        font-size: 1rem; /* ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºã‚’èª¿æ•´ */
      }
      #shortUrlDisplay, #hashDetectedDisplay {
        font-size: 1rem; /* ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºã‚’èª¿æ•´ */
        padding: 0.8rem; /* ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’èª¿æ•´ */
      }
    }
  </style>
</head>
<body>
  <h1>ğŸ”— ã‚·ãƒ§ãƒ¼ãƒˆãƒªãƒ³ã‚¯ä½œæˆã‚µãƒ¼ãƒ“ã‚¹</h1>

  <!-- ãƒ•ã‚©ãƒ¼ãƒ ã®actionã¨methodå±æ€§ã‚’å‰Šé™¤ã—ã€JavaScriptã§å‡¦ç†ã—ã¾ã™ -->
  <form id="shortenForm">
    <input type="url" id="originalUrlInput" placeholder="https://example.com" required />
    <button type="submit">çŸ­ç¸®ã™ã‚‹</button>
    <!-- ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ã¯JavaScriptã§è¡¨ç¤º/éè¡¨ç¤ºã‚’åˆ¶å¾¡ã—ã¾ã™ -->
    <button type="button" id="resetButton" class="secondary-button" style="display: none;">ğŸ”„ ãƒªã‚»ãƒƒãƒˆ</button>
  </form>

  <!-- ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«é–¢ã™ã‚‹æ³¨æ„æ›¸ãã®è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
  <div id="globalLocalStorageNotice" class="local-storage-notice">
    âš ï¸ ã“ã®ã‚µãƒ¼ãƒ“ã‚¹ã§ä½œæˆã•ã‚ŒãŸçŸ­ç¸®URLã¯ã€ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ï¼ˆã¾ãŸã¯ã“ã®ç«¯æœ«ï¼‰ã®ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚ä»–ã®ãƒ–ãƒ©ã‚¦ã‚¶ã‚„ãƒ‡ãƒã‚¤ã‚¹ã‹ã‚‰ã¯ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã›ã‚“ã€‚
  </div>

  <!-- çŸ­ç¸®URLã®è¡¨ç¤ºéƒ¨åˆ†ã€‚åˆæœŸçŠ¶æ…‹ã§ã¯éè¡¨ç¤ºã§ã™ã€‚ -->
  <p id="shortUrlDisplay">
    âœ… çŸ­ç¸®URL: <a id="shortUrlAnchor" href="#" target="_blank" rel="noopener"></a><br>
    <button id="copyButton">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
    <span id="copyMessage"></span>
  </p>

  <!-- ãƒãƒƒã‚·ãƒ¥ä»˜ãURLã§ã‚¢ã‚¯ã‚»ã‚¹ã•ã‚ŒãŸå ´åˆã«è¡¨ç¤ºã•ã‚Œã‚‹éƒ¨åˆ† -->
  <p id="hashDetectedDisplay">
    ã“ã®çŸ­ç¸®URLã¯å…ƒã®URLã«ç´ä»˜ã‘ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚<br>
    å…ƒã®URL: <a id="hashOriginalUrlAnchor" href="#" target="_blank" rel="noopener"></a><br>
    <button id="openOriginalUrlButton">å…ƒã®URLã‚’æ–°ã—ã„ã‚¿ãƒ–ã§é–‹ã</button>
  </p>

  <footer>
    <p id="copyright"></p>
  </footer>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      // --- è‘—ä½œæ¨©è¡¨ç¤ºã®è‡ªå‹•æ›´æ–° ---
      // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒä½œã‚‰ã‚ŒãŸå¹´ (baseYear) ã‹ã‚‰ç¾åœ¨ã®å¹´ã¾ã§ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚
      const baseYear = 2025; // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒä½œã‚‰ã‚ŒãŸå¹´
      const currentYear = new Date().getFullYear(); // ç¾åœ¨ã®å¹´ã‚’å–å¾—
      let yearText;
      if (currentYear === baseYear) {
        // ç¾åœ¨ã®å¹´ãŒåŸºæº–å¹´ã¨åŒã˜å ´åˆã¯ã€ãã®å¹´ã ã‘ã‚’è¡¨ç¤º
        yearText = `${baseYear}`;
      } else {
        // ç¾åœ¨ã®å¹´ãŒåŸºæº–å¹´ã¨ç•°ãªã‚‹å ´åˆã¯ã€ç¯„å›²ã§è¡¨ç¤º (ä¾‹: 2025~ç¾åœ¨ã®å¹´)
        yearText = `${baseYear}~${currentYear}`;
      }
      // copyright IDã‚’æŒã¤è¦ç´ ã«ãƒ†ã‚­ã‚¹ãƒˆã‚’è¨­å®š
      document.getElementById("copyright").textContent = `Â© ${yearText} @hamusata`;

      // --- DOMè¦ç´ ã®å–å¾— ---
      const shortenForm = document.getElementById("shortenForm");
      const originalUrlInput = document.getElementById("originalUrlInput");
      const shortUrlDisplay = document.getElementById("shortUrlDisplay");
      const shortUrlAnchor = document.getElementById("shortUrlAnchor");
      const copyButton = document.getElementById("copyButton");
      const copyMessage = document.getElementById("copyMessage");
      const resetButton = document.getElementById("resetButton");
      const hashDetectedDisplay = document.getElementById("hashDetectedDisplay");
      const hashOriginalUrlAnchor = document.getElementById("hashOriginalUrlAnchor");
      const openOriginalUrlButton = document.getElementById("openOriginalUrlButton");
      const globalLocalStorageNotice = document.getElementById("globalLocalStorageNotice"); // æ–°ã—ãè¿½åŠ 

      // --- ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰ã®URLãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ ---
      // çŸ­ç¸®URLã®ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰èª­ã¿è¾¼ã‚€
      // ãƒ‡ãƒ¼ã‚¿ã¯JSONæ–‡å­—åˆ—ã¨ã—ã¦ä¿å­˜ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€JSON.parse()ã§ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›
      const loadUrlData = () => {
        try {
          return JSON.parse(localStorage.getItem('shortenedUrls')) || {};
        } catch (e) {
          console.error("ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:", e);
          return {};
        }
      };

      // URLãƒ‡ãƒ¼ã‚¿ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜ã™ã‚‹é–¢æ•°
      // ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’JSONæ–‡å­—åˆ—ã«å¤‰æ›ã—ã¦ä¿å­˜
      const saveUrlData = (data) => {
        localStorage.setItem('shortenedUrls', JSON.stringify(data));
      };

      // --- ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªã‚­ãƒ¼ã®ç”Ÿæˆ ---
      // ãƒ©ãƒ³ãƒ€ãƒ ãªæ–‡å­—åˆ—ã‚’ç”Ÿæˆã—ã€æ—¢å­˜ã®ã‚­ãƒ¼ã¨é‡è¤‡ã—ãªã„ã“ã¨ã‚’ç¢ºèª
      const generateUniqueKey = (length = 6) => {
        const chars = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
        let key = '';
        let urlData = loadUrlData(); // æœ€æ–°ã®URLãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦é‡è¤‡ãƒã‚§ãƒƒã‚¯
        do {
          key = Array.from({ length }, () => chars[Math.floor(Math.random() * chars.length)]).join('');
        } while (urlData[key]); // ç”Ÿæˆã•ã‚ŒãŸã‚­ãƒ¼ãŒæ—¢ã«å­˜åœ¨ã™ã‚‹å ´åˆã¯å†ç”Ÿæˆ
        return key;
      };

      // --- è¡¨ç¤ºçŠ¶æ…‹ã‚’ç®¡ç†ã™ã‚‹é–¢æ•° ---
      // ãƒ•ã‚©ãƒ¼ãƒ ã€ç”Ÿæˆã•ã‚ŒãŸçŸ­ç¸®URLè¡¨ç¤ºã€ãƒãƒƒã‚·ãƒ¥æ¤œå‡ºæ™‚ã®è¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆã¾ã™
      // æ³¨æ„æ›¸ãã¯å¸¸ã«è¡¨ç¤ºã•ã‚Œã‚‹ãŸã‚ã€ã“ã“ã§ã¯åˆ¶å¾¡ã—ã¾ã›ã‚“ã€‚
      const showForm = () => {
          shortenForm.style.display = 'flex'; // ãƒ•ã‚©ãƒ¼ãƒ ã‚’è¡¨ç¤º
          originalUrlInput.value = ''; // å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ã‚¯ãƒªã‚¢
          shortUrlDisplay.style.display = 'none'; // ç”Ÿæˆã•ã‚ŒãŸçŸ­ç¸®URLè¡¨ç¤ºã‚’éè¡¨ç¤º
          hashDetectedDisplay.style.display = 'none'; // ãƒãƒƒã‚·ãƒ¥æ¤œå‡ºæ™‚ã®è¡¨ç¤ºã‚’éè¡¨ç¤º
          resetButton.style.display = 'none'; // ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ã‚’éè¡¨ç¤º
          copyMessage.textContent = ''; // ã‚³ãƒ”ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚¯ãƒªã‚¢
      };

      const showGeneratedShortUrl = (shortUrl) => {
          shortenForm.style.display = 'none'; // ãƒ•ã‚©ãƒ¼ãƒ ã‚’éè¡¨ç¤º
          shortUrlDisplay.style.display = 'block'; // ç”Ÿæˆã•ã‚ŒãŸçŸ­ç¸®URLè¡¨ç¤ºã‚’è¡¨ç¤º
          hashDetectedDisplay.style.display = 'none'; // ãƒãƒƒã‚·ãƒ¥æ¤œå‡ºæ™‚ã®è¡¨ç¤ºã‚’éè¡¨ç¤º
          resetButton.style.display = 'block'; // ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
          shortUrlAnchor.href = shortUrl;
          shortUrlAnchor.textContent = shortUrl;
      };

      const showOriginalUrlFromHash = (originalUrl) => {
          shortenForm.style.display = 'none'; // ãƒ•ã‚©ãƒ¼ãƒ ã‚’éè¡¨ç¤º
          shortUrlDisplay.style.display = 'none'; // ç”Ÿæˆã•ã‚ŒãŸçŸ­ç¸®URLè¡¨ç¤ºã‚’éè¡¨ç¤º
          hashDetectedDisplay.style.display = 'block'; // ãƒãƒƒã‚·ãƒ¥æ¤œå‡ºæ™‚ã®è¡¨ç¤ºã‚’è¡¨ç¤º
          resetButton.style.display = 'block'; // ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
          hashOriginalUrlAnchor.href = originalUrl;
          hashOriginalUrlAnchor.textContent = originalUrl;
      };

      // --- ãƒ•ã‚©ãƒ¼ãƒ ã®é€ä¿¡å‡¦ç† (çŸ­ç¸®æ©Ÿèƒ½) ---
      shortenForm.addEventListener("submit", (event) => {
        event.preventDefault(); // ãƒ•ã‚©ãƒ¼ãƒ ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆé€ä¿¡ã‚’é˜²ã

        const originalUrl = originalUrlInput.value.trim();
        if (!originalUrl) {
          return; // URLãŒç©ºã®å ´åˆã¯ä½•ã‚‚ã—ãªã„
        }

        let urlData = loadUrlData();
        const key = generateUniqueKey();
        // çŸ­ç¸®URLã‚’ç”Ÿæˆ (ç¾åœ¨ã®ãƒšãƒ¼ã‚¸ã®URL + ãƒãƒƒã‚·ãƒ¥ # + ã‚­ãƒ¼)
        // ä¾‹: http://localhost/index.html#abcde1
        const shortUrl = window.location.origin + window.location.pathname + '#' + key;

        // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«å…ƒã®URLã‚’ä¿å­˜
        urlData[key] = originalUrl;
        saveUrlData(urlData);

        // ç”Ÿæˆã•ã‚ŒãŸçŸ­ç¸®URLã‚’è¡¨ç¤ºçŠ¶æ…‹ã«ã™ã‚‹
        showGeneratedShortUrl(shortUrl);

        // ãƒ–ãƒ©ã‚¦ã‚¶ã®URLã«ãƒãƒƒã‚·ãƒ¥ã‚’è¿½åŠ ã—ã¦ã€çŸ­ç¸®URLã‚’å…±æœ‰å¯èƒ½ã«ã™ã‚‹
        // ã“ã‚Œã«ã‚ˆã‚Šã€ã“ã®URLã‚’ã‚³ãƒ”ãƒ¼ã—ã¦åŒã˜ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ãã¨ã€ãƒãƒƒã‚·ãƒ¥æ¤œå‡ºæ™‚ã®è¡¨ç¤ºã«ãªã‚‹
        window.location.hash = key;
      });

      // --- ã‚³ãƒ”ãƒ¼ãƒœã‚¿ãƒ³ã®å‡¦ç† ---
      copyButton.addEventListener("click", () => {
        const urlToCopy = shortUrlAnchor.href;
        // ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«çŸ­ç¸®URLã®ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚³ãƒ”ãƒ¼
        // navigator.clipboard.writeTextã¯iframeå†…ã§å‹•ä½œã—ãªã„å ´åˆãŒã‚ã‚‹ãŸã‚ã€
        // document.execCommand('copy')ã‚’ä½¿ç”¨ã™ã‚‹ä»£æ›¿æ‰‹æ®µã‚’å®Ÿè£…
        const tempInput = document.createElement('textarea');
        tempInput.value = urlToCopy;
        document.body.appendChild(tempInput);
        tempInput.select();
        try {
          document.execCommand('copy');
          copyMessage.textContent = "ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼"; // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
          // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯3ç§’å¾Œã«ã‚¯ãƒªã‚¢
          setTimeout(() => copyMessage.textContent = "", 3000);
        } catch (err) {
          console.error('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ:', err);
          copyMessage.textContent = "ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ"; // å¤±æ•—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
          // ã‚³ãƒ”ãƒ¼å¤±æ•—æ™‚ã€5ç§’å¾Œã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚¯ãƒªã‚¢ã—ã€ãƒ•ã‚©ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆ
          setTimeout(() => {
            copyMessage.textContent = ""; // å¤±æ•—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚¯ãƒªã‚¢
            window.location.hash = ''; // URLã®ãƒãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢
            showForm(); // ãƒ•ã‚©ãƒ¼ãƒ è¡¨ç¤ºçŠ¶æ…‹ã«æˆ»ã™
          }, 5000); // 5ç§’å¾Œã«ãƒªã‚»ãƒƒãƒˆ
        } finally {
          document.body.removeChild(tempInput); // ä¸€æ™‚çš„ãªè¦ç´ ã‚’å‰Šé™¤
        }
      });

      // --- ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ã®å‡¦ç† ---
      resetButton.addEventListener("click", () => {
        window.location.hash = ''; // URLã®ãƒãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢
        showForm(); // ãƒ•ã‚©ãƒ¼ãƒ è¡¨ç¤ºçŠ¶æ…‹ã«æˆ»ã™
      });

      // --- ã€Œå…ƒã®URLã‚’æ–°ã—ã„ã‚¿ãƒ–ã§é–‹ãã€ãƒœã‚¿ãƒ³ã®å‡¦ç† ---
      openOriginalUrlButton.addEventListener("click", () => {
        const originalUrl = hashOriginalUrlAnchor.href;
        if (originalUrl && originalUrl !== '#') {
          window.open(originalUrl, '_blank'); // æ–°ã—ã„ã‚¿ãƒ–ã§é–‹ã
        }
      });

      // --- ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã®ãƒãƒƒã‚·ãƒ¥æ¤œå‡ºã¨è¡¨ç¤ºå‡¦ç† ---
      const checkHashOnLoad = () => {
        const hash = window.location.hash.substring(1); // URLã‹ã‚‰#ã‚’é™¤ã„ãŸãƒãƒƒã‚·ãƒ¥å€¤ã‚’å–å¾—
        if (hash) {
          // ãƒãƒƒã‚·ãƒ¥ãŒå­˜åœ¨ã™ã‚‹å ´åˆ
          const urlData = loadUrlData();
          const originalUrl = urlData[hash]; // ãƒãƒƒã‚·ãƒ¥ã«å¯¾å¿œã™ã‚‹å…ƒã®URLã‚’å–å¾—
          if (originalUrl) {
            // å…ƒã®URLãŒè¦‹ã¤ã‹ã£ãŸå ´åˆã¯ã€ãã®URLã‚’è¡¨ç¤ºã™ã‚‹çŠ¶æ…‹ã«ã™ã‚‹
            showOriginalUrlFromHash(originalUrl);
          } else {
            // ãƒãƒƒã‚·ãƒ¥ã«å¯¾å¿œã™ã‚‹URLãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã¯ã€ãƒ•ã‚©ãƒ¼ãƒ è¡¨ç¤ºçŠ¶æ…‹ã«æˆ»ã™
            window.location.hash = ''; // ä¸æ­£ãªãƒãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢
            showForm();
          }
        } else {
          // ãƒãƒƒã‚·ãƒ¥ãŒãªã„å ´åˆã¯ã€ãƒ•ã‚©ãƒ¼ãƒ è¡¨ç¤ºçŠ¶æ…‹ã«ã™ã‚‹
          showForm();
        }
      };

      // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã«ãƒãƒƒã‚·ãƒ¥æ¤œå‡ºå‡¦ç†ã‚’å®Ÿè¡Œ
      checkHashOnLoad();

      // hashchangeã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã¯ä¸è¦ã«ãªã‚Šã¾ã—ãŸï¼ˆè‡ªå‹•è»¢é€ã—ãªã„ãŸã‚ï¼‰
      // window.addEventListener('hashchange', checkHashOnLoad); // ä¸è¦
    });
  </script>
</body>
</html>
